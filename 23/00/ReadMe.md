# [8.10. copy — 浅いコピーおよび深いコピー操作](https://docs.python.jp/3/library/copy.html#module-copy)

< [8. データ型](https://docs.python.jp/3/library/datatypes.html) < [Python 標準ライブラリ](https://docs.python.jp/3/library/index.html#the-python-standard-library) < [ドキュメント](https://docs.python.jp/3/index.html)

ソースコード: [Lib/copy.py](https://github.com/python/cpython/tree/3.6/Lib/copy.py)

## 概要

> Python において代入文はオブジェクトをコピーしません。代入はターゲットとオブジェクトの間に束縛を作ります。ミュータブルなコレクションまたはミュータブルなアイテムを含むコレクションについては、元のオブジェクトを変更せずにコピーを変更できるように、コピーが必要になることが時々あります。このモジュールは、汎用的な浅い (shallow) コピーと深い (deep) コピーの操作 (以下で説明されます) を提供します。

## 一覧

属性|説明
----|----
copy.copy(x)|x の浅い (shallow) コピーを返します。
copy.deepcopy(x)|x の深い (deep) コピーを返します。
exception copy.error|モジュール特有のエラーを送出します。

## 詳細

### 浅い or 深い

> 浅い (shallow) コピーと深い (deep) コピーの違いが関係するのは、複合オブジェクト (リストやクラスインスタンスのような他のオブジェクトを含むオブジェクト) だけです:

#### 浅いコピー

> 浅いコピー (shallow copy) は新たな複合オブジェクトを作成し、その後 (可能な限り) 元のオブジェクト中に見つかったオブジェクトに対する 参照 を挿入します。

#### 深いコピー

> 深いコピー (deep copy) は新たな複合オブジェクトを作成し、その後元のオブジェクト中に見つかったオブジェクトの コピー を挿入します。

> 深いコピー操作には、しばしば浅いコピー操作の時には存在しない 2 つの問題がついてまわります:

> 再帰的なオブジェクト (直接、間接に関わらず、自分自身に対する参照を持つ複合オブジェクト) は再帰ループを引き起こします。

> 深いコピーは何もかもコピーしてしまうため、例えば複数のコピー間で共有するつもりだったデータも余分にコピーしてしまいます。

#### 回避

> deepcopy() 関数では、これらの問題を以下のようにして回避しています:

> 現在のコピー過程ですでにコピーされたオブジェクトからなる、”メモ” 辞書を保持します; かつ

> ユーザ定義のクラスでコピー操作やコピーされる内容の集合を上書きできるようにします。

### コピーしないもの

> このモジュールでは、モジュール、メソッド、スタックトレース、スタックフレーム、ファイル、ソケット、ウィンドウ、アレイ、その他これらに類似の型をコピーしません。このモジュールでは元のオブジェクトを変更せずに返すことで関数とクラスを (浅くまたは深く)「コピー」します。これは pickle モジュールでの扱われかたと同じです。

### dict.copy()

> 辞書型の浅いコピーは dict.copy() で、リストの浅いコピーはリスト全体を指すスライス (例えば copied_list = original_list[:]) でできます。

### pickleインタフェース

> クラスは、コピーを制御するために pickle の制御に使用するのと同じインターフェースを使用することができます。これらのメソッドについての情報はモジュール pickle の説明を参照してください。実際、 copy モジュールは、 copyreg モジュールによって登録された picle 関数を使用します。

### __copy__, __deepcopy__

クラス独自のコピー実装を定義するために、特殊メソッド __copy__() および __deepcopy__() を定義することができます。前者は浅いコピー操作を実装するために使われます; 追加の引数はありません。後者は深いコピー操作を実現するために呼び出されます; この関数には単一の引数としてメモ辞書が渡されます。 __deepcopy__() の実装で、内容のオブジェクトに対して深いコピーを生成する必要がある場合、 deepcopy() を呼び出し、最初の引数にそのオブジェクトを、メモ辞書を二つ目の引数に与えなければなりません。

### 参考

* [pickle](https://docs.python.jp/3/library/pickle.html#module-pickle) モジュール

> オブジェクト状態の取得と復元をサポートするために使われる特殊メソッドについて議論されています。

